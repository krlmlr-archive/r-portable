<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>Introduction to R6 classes</title>


<style type="text/css">code{white-space: pre;}</style>
<link href="data:text/css;charset=utf-8,pre%20%2Eoperator%2C%0Apre%20%2Eparen%20%7B%0Acolor%3A%20rgb%28104%2C%20118%2C%20135%29%0A%7D%0Apre%20%2Eliteral%20%7B%0Acolor%3A%20%23990073%0A%7D%0Apre%20%2Enumber%20%7B%0Acolor%3A%20%23099%3B%0A%7D%0Apre%20%2Ecomment%20%7B%0Acolor%3A%20%23998%3B%0Afont%2Dstyle%3A%20italic%0A%7D%0Apre%20%2Ekeyword%20%7B%0Acolor%3A%20%23900%3B%0Afont%2Dweight%3A%20bold%0A%7D%0Apre%20%2Eidentifier%20%7B%0Acolor%3A%20rgb%280%2C%200%2C%200%29%3B%0A%7D%0Apre%20%2Estring%20%7B%0Acolor%3A%20%23d14%3B%0A%7D%0A" rel="stylesheet" type="text/css" />
<script src="data:application/x-javascript;base64,CnZhciBobGpzPW5ldyBmdW5jdGlvbigpe2Z1bmN0aW9uIG0ocCl7cmV0dXJuIHAucmVwbGFjZSgvJi9nbSwiJmFtcDsiKS5yZXBsYWNlKC88L2dtLCImbHQ7Iil9ZnVuY3Rpb24gZihyLHEscCl7cmV0dXJuIFJlZ0V4cChxLCJtIisoci5jST8iaSI6IiIpKyhwPyJnIjoiIikpfWZ1bmN0aW9uIGIocil7Zm9yKHZhciBwPTA7cDxyLmNoaWxkTm9kZXMubGVuZ3RoO3ArKyl7dmFyIHE9ci5jaGlsZE5vZGVzW3BdO2lmKHEubm9kZU5hbWU9PSJDT0RFIil7cmV0dXJuIHF9aWYoIShxLm5vZGVUeXBlPT0zJiZxLm5vZGVWYWx1ZS5tYXRjaCgvXHMrLykpKXticmVha319fWZ1bmN0aW9uIGgodCxzKXt2YXIgcD0iIjtmb3IodmFyIHI9MDtyPHQuY2hpbGROb2Rlcy5sZW5ndGg7cisrKXtpZih0LmNoaWxkTm9kZXNbcl0ubm9kZVR5cGU9PTMpe3ZhciBxPXQuY2hpbGROb2Rlc1tyXS5ub2RlVmFsdWU7aWYocyl7cT1xLnJlcGxhY2UoL1xuL2csIiIpfXArPXF9ZWxzZXtpZih0LmNoaWxkTm9kZXNbcl0ubm9kZU5hbWU9PSJCUiIpe3ArPSJcbiJ9ZWxzZXtwKz1oKHQuY2hpbGROb2Rlc1tyXSl9fX1pZigvTVNJRSBbNjc4XS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7cD1wLnJlcGxhY2UoL1xyL2csIlxuIil9cmV0dXJuIHB9ZnVuY3Rpb24gYShzKXt2YXIgcj1zLmNsYXNzTmFtZS5zcGxpdCgvXHMrLyk7cj1yLmNvbmNhdChzLnBhcmVudE5vZGUuY2xhc3NOYW1lLnNwbGl0KC9ccysvKSk7Zm9yKHZhciBxPTA7cTxyLmxlbmd0aDtxKyspe3ZhciBwPXJbcV0ucmVwbGFjZSgvXmxhbmd1YWdlLS8sIiIpO2lmKGVbcF0pe3JldHVybiBwfX19ZnVuY3Rpb24gYyhxKXt2YXIgcD1bXTsoZnVuY3Rpb24ocyx0KXtmb3IodmFyIHI9MDtyPHMuY2hpbGROb2Rlcy5sZW5ndGg7cisrKXtpZihzLmNoaWxkTm9kZXNbcl0ubm9kZVR5cGU9PTMpe3QrPXMuY2hpbGROb2Rlc1tyXS5ub2RlVmFsdWUubGVuZ3RofWVsc2V7aWYocy5jaGlsZE5vZGVzW3JdLm5vZGVOYW1lPT0iQlIiKXt0Kz0xfWVsc2V7aWYocy5jaGlsZE5vZGVzW3JdLm5vZGVUeXBlPT0xKXtwLnB1c2goe2V2ZW50OiJzdGFydCIsb2Zmc2V0OnQsbm9kZTpzLmNoaWxkTm9kZXNbcl19KTt0PWFyZ3VtZW50cy5jYWxsZWUocy5jaGlsZE5vZGVzW3JdLHQpO3AucHVzaCh7ZXZlbnQ6InN0b3AiLG9mZnNldDp0LG5vZGU6cy5jaGlsZE5vZGVzW3JdfSl9fX19cmV0dXJuIHR9KShxLDApO3JldHVybiBwfWZ1bmN0aW9uIGsoeSx3LHgpe3ZhciBxPTA7dmFyIHo9IiI7dmFyIHM9W107ZnVuY3Rpb24gdSgpe2lmKHkubGVuZ3RoJiZ3Lmxlbmd0aCl7aWYoeVswXS5vZmZzZXQhPXdbMF0ub2Zmc2V0KXtyZXR1cm4oeVswXS5vZmZzZXQ8d1swXS5vZmZzZXQpP3k6d31lbHNle3JldHVybiB3WzBdLmV2ZW50PT0ic3RhcnQiP3k6d319ZWxzZXtyZXR1cm4geS5sZW5ndGg/eTp3fX1mdW5jdGlvbiB0KEQpe3ZhciBBPSI8IitELm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7Zm9yKHZhciBCPTA7QjxELmF0dHJpYnV0ZXMubGVuZ3RoO0IrKyl7dmFyIEM9RC5hdHRyaWJ1dGVzW0JdO0ErPSIgIitDLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYoQy52YWx1ZSE9PXVuZGVmaW5lZCYmQy52YWx1ZSE9PWZhbHNlJiZDLnZhbHVlIT09bnVsbCl7QSs9Jz0iJyttKEMudmFsdWUpKyciJ319cmV0dXJuIEErIj4ifXdoaWxlKHkubGVuZ3RofHx3Lmxlbmd0aCl7dmFyIHY9dSgpLnNwbGljZSgwLDEpWzBdO3orPW0oeC5zdWJzdHIocSx2Lm9mZnNldC1xKSk7cT12Lm9mZnNldDtpZih2LmV2ZW50PT0ic3RhcnQiKXt6Kz10KHYubm9kZSk7cy5wdXNoKHYubm9kZSl9ZWxzZXtpZih2LmV2ZW50PT0ic3RvcCIpe3ZhciBwLHI9cy5sZW5ndGg7ZG97ci0tO3A9c1tyXTt6Kz0oIjwvIitwLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkrIj4iKX13aGlsZShwIT12Lm5vZGUpO3Muc3BsaWNlKHIsMSk7d2hpbGUocjxzLmxlbmd0aCl7eis9dChzW3JdKTtyKyt9fX19cmV0dXJuIHorbSh4LnN1YnN0cihxKSl9ZnVuY3Rpb24gaigpe2Z1bmN0aW9uIHEoeCx5LHYpe2lmKHguY29tcGlsZWQpe3JldHVybn12YXIgdTt2YXIgcz1bXTtpZih4Lmspe3gubFI9Zih5LHgubHx8aGxqcy5JUix0cnVlKTtmb3IodmFyIHcgaW4geC5rKXtpZigheC5rLmhhc093blByb3BlcnR5KHcpKXtjb250aW51ZX1pZih4Lmtbd10gaW5zdGFuY2VvZiBPYmplY3Qpe3U9eC5rW3ddfWVsc2V7dT14Lms7dz0ia2V5d29yZCJ9Zm9yKHZhciByIGluIHUpe2lmKCF1Lmhhc093blByb3BlcnR5KHIpKXtjb250aW51ZX14Lmtbcl09W3csdVtyXV07cy5wdXNoKHIpfX19aWYoIXYpe2lmKHguYldLKXt4LmI9IlxcYigiK3Muam9pbigifCIpKyIpXFxzIn14LmJSPWYoeSx4LmI/eC5iOiJcXEJ8XFxiIik7aWYoIXguZSYmIXguZVcpe3guZT0iXFxCfFxcYiJ9aWYoeC5lKXt4LmVSPWYoeSx4LmUpfX1pZih4Lmkpe3guaVI9Zih5LHguaSl9aWYoeC5yPT09dW5kZWZpbmVkKXt4LnI9MX1pZigheC5jKXt4LmM9W119eC5jb21waWxlZD10cnVlO2Zvcih2YXIgdD0wO3Q8eC5jLmxlbmd0aDt0Kyspe2lmKHguY1t0XT09InNlbGYiKXt4LmNbdF09eH1xKHguY1t0XSx5LGZhbHNlKX1pZih4LnN0YXJ0cyl7cSh4LnN0YXJ0cyx5LGZhbHNlKX19Zm9yKHZhciBwIGluIGUpe2lmKCFlLmhhc093blByb3BlcnR5KHApKXtjb250aW51ZX1xKGVbcF0uZE0sZVtwXSx0cnVlKX19ZnVuY3Rpb24gZChCLEMpe2lmKCFqLmNhbGxlZCl7aigpO2ouY2FsbGVkPXRydWV9ZnVuY3Rpb24gcShyLE0pe2Zvcih2YXIgTD0wO0w8TS5jLmxlbmd0aDtMKyspe2lmKChNLmNbTF0uYlIuZXhlYyhyKXx8W251bGxdKVswXT09cil7cmV0dXJuIE0uY1tMXX19fWZ1bmN0aW9uIHYoTCxyKXtpZihEW0xdLmUmJkRbTF0uZVIudGVzdChyKSl7cmV0dXJuIDF9aWYoRFtMXS5lVyl7dmFyIE09dihMLTEscik7cmV0dXJuIE0/TSsxOjB9cmV0dXJuIDB9ZnVuY3Rpb24gdyhyLEwpe3JldHVybiBMLmkmJkwuaVIudGVzdChyKX1mdW5jdGlvbiBLKE4sTyl7dmFyIE09W107Zm9yKHZhciBMPTA7TDxOLmMubGVuZ3RoO0wrKyl7TS5wdXNoKE4uY1tMXS5iKX12YXIgcj1ELmxlbmd0aC0xO2Rve2lmKERbcl0uZSl7TS5wdXNoKERbcl0uZSl9ci0tfXdoaWxlKERbcisxXS5lVyk7aWYoTi5pKXtNLnB1c2goTi5pKX1yZXR1cm4gZihPLE0uam9pbigifCIpLHRydWUpfWZ1bmN0aW9uIHAoTSxMKXt2YXIgTj1EW0QubGVuZ3RoLTFdO2lmKCFOLnQpe04udD1LKE4sRSl9Ti50Lmxhc3RJbmRleD1MO3ZhciByPU4udC5leGVjKE0pO3JldHVybiByP1tNLnN1YnN0cihMLHIuaW5kZXgtTCksclswXSxmYWxzZV06W00uc3Vic3RyKEwpLCIiLHRydWVdfWZ1bmN0aW9uIHooTixyKXt2YXIgTD1FLmNJP3JbMF0udG9Mb3dlckNhc2UoKTpyWzBdO3ZhciBNPU4ua1tMXTtpZihNJiZNIGluc3RhbmNlb2YgQXJyYXkpe3JldHVybiBNfXJldHVybiBmYWxzZX1mdW5jdGlvbiBGKEwsUCl7TD1tKEwpO2lmKCFQLmspe3JldHVybiBMfXZhciByPSIiO3ZhciBPPTA7UC5sUi5sYXN0SW5kZXg9MDt2YXIgTT1QLmxSLmV4ZWMoTCk7d2hpbGUoTSl7cis9TC5zdWJzdHIoTyxNLmluZGV4LU8pO3ZhciBOPXooUCxNKTtpZihOKXt4Kz1OWzFdO3IrPSc8c3BhbiBjbGFzcz0iJytOWzBdKyciPicrTVswXSsiPC9zcGFuPiJ9ZWxzZXtyKz1NWzBdfU89UC5sUi5sYXN0SW5kZXg7TT1QLmxSLmV4ZWMoTCl9cmV0dXJuIHIrTC5zdWJzdHIoTyxMLmxlbmd0aC1PKX1mdW5jdGlvbiBKKEwsTSl7aWYoTS5zTCYmZVtNLnNMXSl7dmFyIHI9ZChNLnNMLEwpO3grPXIua2V5d29yZF9jb3VudDtyZXR1cm4gci52YWx1ZX1lbHNle3JldHVybiBGKEwsTSl9fWZ1bmN0aW9uIEkoTSxyKXt2YXIgTD1NLmNOPyc8c3BhbiBjbGFzcz0iJytNLmNOKyciPic6IiI7aWYoTS5yQil7eSs9TDtNLmJ1ZmZlcj0iIn1lbHNle2lmKE0uZUIpe3krPW0ocikrTDtNLmJ1ZmZlcj0iIn1lbHNle3krPUw7TS5idWZmZXI9cn19RC5wdXNoKE0pO0ErPU0ucn1mdW5jdGlvbiBHKE4sTSxRKXt2YXIgUj1EW0QubGVuZ3RoLTFdO2lmKFEpe3krPUooUi5idWZmZXIrTixSKTtyZXR1cm4gZmFsc2V9dmFyIFA9cShNLFIpO2lmKFApe3krPUooUi5idWZmZXIrTixSKTtJKFAsTSk7cmV0dXJuIFAuckJ9dmFyIEw9dihELmxlbmd0aC0xLE0pO2lmKEwpe3ZhciBPPVIuY04/Ijwvc3Bhbj4iOiIiO2lmKFIuckUpe3krPUooUi5idWZmZXIrTixSKStPfWVsc2V7aWYoUi5lRSl7eSs9SihSLmJ1ZmZlcitOLFIpK08rbShNKX1lbHNle3krPUooUi5idWZmZXIrTitNLFIpK099fXdoaWxlKEw+MSl7Tz1EW0QubGVuZ3RoLTJdLmNOPyI8L3NwYW4+IjoiIjt5Kz1PO0wtLTtELmxlbmd0aC0tfXZhciByPURbRC5sZW5ndGgtMV07RC5sZW5ndGgtLTtEW0QubGVuZ3RoLTFdLmJ1ZmZlcj0iIjtpZihyLnN0YXJ0cyl7SShyLnN0YXJ0cywiIil9cmV0dXJuIFIuckV9aWYodyhNLFIpKXt0aHJvdyJJbGxlZ2FsIn19dmFyIEU9ZVtCXTt2YXIgRD1bRS5kTV07dmFyIEE9MDt2YXIgeD0wO3ZhciB5PSIiO3RyeXt2YXIgcyx1PTA7RS5kTS5idWZmZXI9IiI7ZG97cz1wKEMsdSk7dmFyIHQ9RyhzWzBdLHNbMV0sc1syXSk7dSs9c1swXS5sZW5ndGg7aWYoIXQpe3UrPXNbMV0ubGVuZ3RofX13aGlsZSghc1syXSk7aWYoRC5sZW5ndGg+MSl7dGhyb3ciSWxsZWdhbCJ9cmV0dXJue3I6QSxrZXl3b3JkX2NvdW50OngsdmFsdWU6eX19Y2F0Y2goSCl7aWYoSD09IklsbGVnYWwiKXtyZXR1cm57cjowLGtleXdvcmRfY291bnQ6MCx2YWx1ZTptKEMpfX1lbHNle3Rocm93IEh9fX1mdW5jdGlvbiBnKHQpe3ZhciBwPXtrZXl3b3JkX2NvdW50OjAscjowLHZhbHVlOm0odCl9O3ZhciByPXA7Zm9yKHZhciBxIGluIGUpe2lmKCFlLmhhc093blByb3BlcnR5KHEpKXtjb250aW51ZX12YXIgcz1kKHEsdCk7cy5sYW5ndWFnZT1xO2lmKHMua2V5d29yZF9jb3VudCtzLnI+ci5rZXl3b3JkX2NvdW50K3Iucil7cj1zfWlmKHMua2V5d29yZF9jb3VudCtzLnI+cC5rZXl3b3JkX2NvdW50K3Aucil7cj1wO3A9c319aWYoci5sYW5ndWFnZSl7cC5zZWNvbmRfYmVzdD1yfXJldHVybiBwfWZ1bmN0aW9uIGkocixxLHApe2lmKHEpe3I9ci5yZXBsYWNlKC9eKCg8W14+XSs+fFx0KSspL2dtLGZ1bmN0aW9uKHQsdyx2LHUpe3JldHVybiB3LnJlcGxhY2UoL1x0L2cscSl9KX1pZihwKXtyPXIucmVwbGFjZSgvXG4vZywiPGJyPiIpfXJldHVybiByfWZ1bmN0aW9uIG4odCx3LHIpe3ZhciB4PWgodCxyKTt2YXIgdj1hKHQpO3ZhciB5LHM7aWYodil7eT1kKHYseCl9ZWxzZXtyZXR1cm59dmFyIHE9Yyh0KTtpZihxLmxlbmd0aCl7cz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwcmUiKTtzLmlubmVySFRNTD15LnZhbHVlO3kudmFsdWU9ayhxLGMocykseCl9eS52YWx1ZT1pKHkudmFsdWUsdyxyKTt2YXIgdT10LmNsYXNzTmFtZTtpZighdS5tYXRjaCgiKFxcc3xeKShsYW5ndWFnZS0pPyIrdisiKFxcc3wkKSIpKXt1PXU/KHUrIiAiK3YpOnZ9aWYoL01TSUUgWzY3OF0vLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkmJnQudGFnTmFtZT09IkNPREUiJiZ0LnBhcmVudE5vZGUudGFnTmFtZT09IlBSRSIpe3M9dC5wYXJlbnROb2RlO3ZhciBwPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3AuaW5uZXJIVE1MPSI8cHJlPjxjb2RlPiIreS52YWx1ZSsiPC9jb2RlPjwvcHJlPiI7dD1wLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZDtwLmZpcnN0Q2hpbGQuY049cy5jTjtzLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHAuZmlyc3RDaGlsZCxzKX1lbHNle3QuaW5uZXJIVE1MPXkudmFsdWV9dC5jbGFzc05hbWU9dTt0LnJlc3VsdD17bGFuZ3VhZ2U6dixrdzp5LmtleXdvcmRfY291bnQscmU6eS5yfTtpZih5LnNlY29uZF9iZXN0KXt0LnNlY29uZF9iZXN0PXtsYW5ndWFnZTp5LnNlY29uZF9iZXN0Lmxhbmd1YWdlLGt3Onkuc2Vjb25kX2Jlc3Qua2V5d29yZF9jb3VudCxyZTp5LnNlY29uZF9iZXN0LnJ9fX1mdW5jdGlvbiBvKCl7aWYoby5jYWxsZWQpe3JldHVybn1vLmNhbGxlZD10cnVlO3ZhciByPWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwcmUiKTtmb3IodmFyIHA9MDtwPHIubGVuZ3RoO3ArKyl7dmFyIHE9YihyW3BdKTtpZihxKXtuKHEsaGxqcy50YWJSZXBsYWNlKX19fWZ1bmN0aW9uIGwoKXtpZih3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcil7d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLG8sZmFsc2UpO3dpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIixvLGZhbHNlKX1lbHNle2lmKHdpbmRvdy5hdHRhY2hFdmVudCl7d2luZG93LmF0dGFjaEV2ZW50KCJvbmxvYWQiLG8pfWVsc2V7d2luZG93Lm9ubG9hZD1vfX19dmFyIGU9e307dGhpcy5MQU5HVUFHRVM9ZTt0aGlzLmhpZ2hsaWdodD1kO3RoaXMuaGlnaGxpZ2h0QXV0bz1nO3RoaXMuZml4TWFya3VwPWk7dGhpcy5oaWdobGlnaHRCbG9jaz1uO3RoaXMuaW5pdEhpZ2hsaWdodGluZz1vO3RoaXMuaW5pdEhpZ2hsaWdodGluZ09uTG9hZD1sO3RoaXMuSVI9IlthLXpBLVpdW2EtekEtWjAtOV9dKiI7dGhpcy5VSVI9IlthLXpBLVpfXVthLXpBLVowLTlfXSoiO3RoaXMuTlI9IlxcYlxcZCsoXFwuXFxkKyk/Ijt0aGlzLkNOUj0iXFxiKDBbeFhdW2EtZkEtRjAtOV0rfChcXGQrKFxcLlxcZCopP3xcXC5cXGQrKShbZUVdWy0rXT9cXGQrKT8pIjt0aGlzLkJOUj0iXFxiKDBiWzAxXSspIjt0aGlzLlJTUj0iIXwhPXwhPT18JXwlPXwmfCYmfCY9fFxcKnxcXCo9fFxcK3xcXCs9fCx8XFwufC18LT18L3wvPXw6fDt8PHw8PHw8PD18PD18PXw9PXw9PT18Pnw+PXw+Pnw+Pj18Pj4+fD4+Pj18XFw/fFxcW3xcXHt8XFwofFxcXnxcXF49fFxcfHxcXHw9fFxcfFxcfHx+Ijt0aGlzLkVSPSIoPyFbXFxzXFxTXSkiO3RoaXMuQkU9e2I6IlxcXFwuIixyOjB9O3RoaXMuQVNNPXtjTjoic3RyaW5nIixiOiInIixlOiInIixpOiJcXG4iLGM6W3RoaXMuQkVdLHI6MH07dGhpcy5RU009e2NOOiJzdHJpbmciLGI6JyInLGU6JyInLGk6IlxcbiIsYzpbdGhpcy5CRV0scjowfTt0aGlzLkNMQ009e2NOOiJjb21tZW50IixiOiIvLyIsZToiJCJ9O3RoaXMuQ0JMQ0xNPXtjTjoiY29tbWVudCIsYjoiL1xcKiIsZToiXFwqLyJ9O3RoaXMuSENNPXtjTjoiY29tbWVudCIsYjoiIyIsZToiJCJ9O3RoaXMuTk09e2NOOiJudW1iZXIiLGI6dGhpcy5OUixyOjB9O3RoaXMuQ05NPXtjTjoibnVtYmVyIixiOnRoaXMuQ05SLHI6MH07dGhpcy5CTk09e2NOOiJudW1iZXIiLGI6dGhpcy5CTlIscjowfTt0aGlzLmluaGVyaXQ9ZnVuY3Rpb24ocixzKXt2YXIgcD17fTtmb3IodmFyIHEgaW4gcil7cFtxXT1yW3FdfWlmKHMpe2Zvcih2YXIgcSBpbiBzKXtwW3FdPXNbcV19fXJldHVybiBwfX0oKTtobGpzLkxBTkdVQUdFUy5jcHA9ZnVuY3Rpb24oKXt2YXIgYT17a2V5d29yZDp7ImZhbHNlIjoxLCJpbnQiOjEsImZsb2F0IjoxLCJ3aGlsZSI6MSwicHJpdmF0ZSI6MSwiY2hhciI6MSwiY2F0Y2giOjEsImV4cG9ydCI6MSx2aXJ0dWFsOjEsb3BlcmF0b3I6MixzaXplb2Y6MixkeW5hbWljX2Nhc3Q6Mix0eXBlZGVmOjIsY29uc3RfY2FzdDoyLCJjb25zdCI6MSxzdHJ1Y3Q6MSwiZm9yIjoxLHN0YXRpY19jYXN0OjIsdW5pb246MSxuYW1lc3BhY2U6MSx1bnNpZ25lZDoxLCJsb25nIjoxLCJ0aHJvdyI6MSwidm9sYXRpbGUiOjIsInN0YXRpYyI6MSwicHJvdGVjdGVkIjoxLGJvb2w6MSx0ZW1wbGF0ZToxLG11dGFibGU6MSwiaWYiOjEsInB1YmxpYyI6MSxmcmllbmQ6MiwiZG8iOjEsInJldHVybiI6MSwiZ290byI6MSxhdXRvOjEsInZvaWQiOjIsImVudW0iOjEsImVsc2UiOjEsImJyZWFrIjoxLCJuZXciOjEsZXh0ZXJuOjEsdXNpbmc6MSwidHJ1ZSI6MSwiY2xhc3MiOjEsYXNtOjEsImNhc2UiOjEsdHlwZWlkOjEsInNob3J0IjoxLHJlaW50ZXJwcmV0X2Nhc3Q6MiwiZGVmYXVsdCI6MSwiZG91YmxlIjoxLHJlZ2lzdGVyOjEsZXhwbGljaXQ6MSxzaWduZWQ6MSx0eXBlbmFtZToxLCJ0cnkiOjEsInRoaXMiOjEsInN3aXRjaCI6MSwiY29udGludWUiOjEsd2NoYXJfdDoxLGlubGluZToxLCJkZWxldGUiOjEsYWxpZ25vZjoxLGNoYXIxNl90OjEsY2hhcjMyX3Q6MSxjb25zdGV4cHI6MSxkZWNsdHlwZToxLG5vZXhjZXB0OjEsbnVsbHB0cjoxLHN0YXRpY19hc3NlcnQ6MSx0aHJlYWRfbG9jYWw6MSxyZXN0cmljdDoxLF9Cb29sOjEsY29tcGxleDoxfSxidWlsdF9pbjp7c3RkOjEsc3RyaW5nOjEsY2luOjEsY291dDoxLGNlcnI6MSxjbG9nOjEsc3RyaW5nc3RyZWFtOjEsaXN0cmluZ3N0cmVhbToxLG9zdHJpbmdzdHJlYW06MSxhdXRvX3B0cjoxLGRlcXVlOjEsbGlzdDoxLHF1ZXVlOjEsc3RhY2s6MSx2ZWN0b3I6MSxtYXA6MSxzZXQ6MSxiaXRzZXQ6MSxtdWx0aXNldDoxLG11bHRpbWFwOjEsdW5vcmRlcmVkX3NldDoxLHVub3JkZXJlZF9tYXA6MSx1bm9yZGVyZWRfbXVsdGlzZXQ6MSx1bm9yZGVyZWRfbXVsdGltYXA6MSxhcnJheToxLHNoYXJlZF9wdHI6MX19O3JldHVybntkTTp7azphLGk6IjwvIixjOltobGpzLkNMQ00saGxqcy5DQkxDTE0saGxqcy5RU00se2NOOiJzdHJpbmciLGI6IidcXFxcPy4iLGU6IiciLGk6Ii4ifSx7Y046Im51bWJlciIsYjoiXFxiKFxcZCsoXFwuXFxkKik/fFxcLlxcZCspKHV8VXxsfEx8dWx8VUx8ZnxGKSJ9LGhsanMuQ05NLHtjTjoicHJlcHJvY2Vzc29yIixiOiIjIixlOiIkIn0se2NOOiJzdGxfY29udGFpbmVyIixiOiJcXGIoZGVxdWV8bGlzdHxxdWV1ZXxzdGFja3x2ZWN0b3J8bWFwfHNldHxiaXRzZXR8bXVsdGlzZXR8bXVsdGltYXB8dW5vcmRlcmVkX21hcHx1bm9yZGVyZWRfc2V0fHVub3JkZXJlZF9tdWx0aXNldHx1bm9yZGVyZWRfbXVsdGltYXB8YXJyYXkpXFxzKjwiLGU6Ij4iLGs6YSxyOjEwLGM6WyJzZWxmIl19XX19fSgpO2hsanMuTEFOR1VBR0VTLnI9e2RNOntjOltobGpzLkhDTSx7Y046Im51bWJlciIsYjoiXFxiMFt4WF1bMC05YS1mQS1GXStbTGldP1xcYiIsZTpobGpzLklNTUVESUFURV9SRSxyOjB9LHtjTjoibnVtYmVyIixiOiJcXGJcXGQrKD86W2VFXVsrXFwtXT9cXGQqKT9MXFxiIixlOmhsanMuSU1NRURJQVRFX1JFLHI6MH0se2NOOiJudW1iZXIiLGI6IlxcYlxcZCtcXC4oPyFcXGQpKD86aVxcYik/IixlOmhsanMuSU1NRURJQVRFX1JFLHI6MX0se2NOOiJudW1iZXIiLGI6IlxcYlxcZCsoPzpcXC5cXGQqKT8oPzpbZUVdWytcXC1dP1xcZCopP2k/XFxiIixlOmhsanMuSU1NRURJQVRFX1JFLHI6MH0se2NOOiJudW1iZXIiLGI6IlxcLlxcZCsoPzpbZUVdWytcXC1dP1xcZCopP2k/XFxiIixlOmhsanMuSU1NRURJQVRFX1JFLHI6MX0se2NOOiJrZXl3b3JkIixiOiIoPzp0cnlDYXRjaHxsaWJyYXJ5fHNldEdlbmVyaWN8c2V0R3JvdXBHZW5lcmljKVxcYiIsZTpobGpzLklNTUVESUFURV9SRSxyOjEwfSx7Y046ImtleXdvcmQiLGI6IlxcLlxcLlxcLiIsZTpobGpzLklNTUVESUFURV9SRSxyOjEwfSx7Y046ImtleXdvcmQiLGI6IlxcLlxcLlxcZCsoPyFbXFx3Ll0pIixlOmhsanMuSU1NRURJQVRFX1JFLHI6MTB9LHtjTjoia2V5d29yZCIsYjoiXFxiKD86ZnVuY3Rpb24pIixlOmhsanMuSU1NRURJQVRFX1JFLHI6Mn0se2NOOiJrZXl3b3JkIixiOiIoPzppZnxpbnxicmVha3xuZXh0fHJlcGVhdHxlbHNlfGZvcnxyZXR1cm58c3dpdGNofHdoaWxlfHRyeXxzdG9wfHdhcm5pbmd8cmVxdWlyZXxhdHRhY2h8ZGV0YWNofHNvdXJjZXxzZXRNZXRob2R8c2V0Q2xhc3MpXFxiIixlOmhsanMuSU1NRURJQVRFX1JFLHI6MX0se2NOOiJsaXRlcmFsIixiOiIoPzpOQXxOQV9pbnRlZ2VyX3xOQV9yZWFsX3xOQV9jaGFyYWN0ZXJffE5BX2NvbXBsZXhfKVxcYiIsZTpobGpzLklNTUVESUFURV9SRSxyOjEwfSx7Y046ImxpdGVyYWwiLGI6Iig/Ok5VTEx8VFJVRXxGQUxTRXxUfEZ8SW5mfE5hTilcXGIiLGU6aGxqcy5JTU1FRElBVEVfUkUscjoxfSx7Y046ImlkZW50aWZpZXIiLGI6IlthLXpBLVouXVthLXpBLVowLTkuX10qXFxiIixlOmhsanMuSU1NRURJQVRFX1JFLHI6MH0se2NOOiJvcGVyYXRvciIsYjoiPFxcLSg/IVxccypcXGQpIixlOmhsanMuSU1NRURJQVRFX1JFLHI6Mn0se2NOOiJvcGVyYXRvciIsYjoiXFwtPnw8XFwtIixlOmhsanMuSU1NRURJQVRFX1JFLHI6MX0se2NOOiJvcGVyYXRvciIsYjoiJSV8fiIsZTpobGpzLklNTUVESUFURV9SRX0se2NOOiJvcGVyYXRvciIsYjoiPj18PD18PT18IT18XFx8XFx8fCYmfD18XFwrfFxcLXxcXCp8L3xcXF58Pnw8fCF8JnxcXHx8XFwkfDoiLGU6aGxqcy5JTU1FRElBVEVfUkUscjowfSx7Y046Im9wZXJhdG9yIixiOiIlIixlOiIlIixpOiJcXG4iLHI6MX0se2NOOiJpZGVudGlmaWVyIixiOiJgIixlOiJgIixyOjB9LHtjTjoic3RyaW5nIixiOiciJyxlOiciJyxjOltobGpzLkJFXSxyOjB9LHtjTjoic3RyaW5nIixiOiInIixlOiInIixjOltobGpzLkJFXSxyOjB9LHtjTjoicGFyZW4iLGI6IltbKHtcXF0pfV0iLGU6aGxqcy5JTU1FRElBVEVfUkUscjowfV19fTsKaGxqcy5pbml0SGlnaGxpZ2h0aW5nT25Mb2FkKCk7Cgo="></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>


<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%200%20auto%3B%0Amax%2Dwidth%3A%20800px%3B%0Afloat%3A%20center%3B%0Amargin%2Dleft%3A%20auto%3B%0Amargin%2Dright%3A%20auto%3B%0Aoverflow%3A%20visible%3B%0A%7D%0Abody%20%23header%20%7B%0Aclear%3A%20both%3B%0Amargin%2Dbottom%3A%208px%3B%0Aborder%2Dbottom%3A%202px%20solid%20%23999%3B%0Afont%2Dsize%3A%2020px%3B%0Apadding%3A%202px%2010px%202px%2025px%3B%0A%7D%0Abody%20%23content%20%7B%0Abackground%2Dcolor%3A%20white%3B%0Aclear%3A%20both%3B%0Afloat%3A%20left%3B%0Aoverflow%3A%20visible%3B%0Apadding%3A%2010px%3B%0Aborder%3A%201px%20solid%20%23BBBBBB%3B%0Aborder%2Dradius%3A%205px%3B%0Awidth%3A%20780px%3B%0A%7D%0Abody%20%23footer%20%7B%0Abackground%2Dcolor%3A%20%2399BBDD%3B%0Aclear%3A%20both%3B%0Afloat%3A%20left%3B%0Amargin%3A%208px%200%3B%0Aborder%3A%201px%20solid%20%236688AA%3B%0Aborder%2Dradius%3A%205px%3B%0Apadding%3A%200%2010px%3B%0Awidth%3A%20780px%3B%0A%7D%0Abody%20%2Eclear%20%7B%0Aclear%3A%20both%3B%0Aborder%2Dwidth%3A%200%3B%0Amargin%3A%200%3B%0Avisibility%3A%20hidden%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%2Dleft%3A%2025px%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dspacing%3A%200px%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcolor%3A%20gray%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Abackground%2Dcolor%3A%20white%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Abackground%2Dcolor%3A%20white%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%202px%205px%3B%0A%7D%0Ap%20%7B%0Amargin%2Dleft%3A%2015px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%2013px%3B%0Apadding%2Dbottom%3A%201px%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Acolor%3A%20%23000%3B%0Apadding%3A%200px%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Acolor%3A%20%23333%3B%0Aborder%3A%201px%20solid%20%23ddd%3B%0Aborder%2Dradius%3A%203px%3B%0Abackground%2Dcolor%3A%20%23f8f8f8%3B%0Afont%2Dsize%3A%2080%25%3B%0Apadding%3A%200px%202px%3B%0A%7D%0A%0Apre%20%7B%0Afont%2Dsize%3A%2012px%3B%0Aline%2Dheight%3A%2016px%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%2Er%20%7B%0Abackground%2Dcolor%3A%20%23F3F5F7%3B%0Apadding%3A%204px%2010px%3B%0Aborder%3A%201px%20solid%20%23AEBDCC%3B%0Aborder%2Dradius%3A%205px%3B%0Amargin%3A%205px%205px%2010px%2020px%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Abox%2Dshadow%3A%202px%202px%2012px%20%2D5px%20%23999999%3B%0Amargin%3A%200%205px%3B%0A%7D%0Abody%20%7B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2015px%3B%0Aline%2Dheight%3A%2022px%3B%0A%7D%0Abody%20%23header%20%7B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23ccc%3B%0Awidth%3A%2085%25%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%2022px%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23ccc%3B%0Awidth%3A%2075%25%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%2018px%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Awidth%3A%2060%25%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%2016px%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Awidth%3A%2060%25%3B%0Amargin%2Dleft%3A%2015px%3B%0Afont%2Dsize%3A%2016px%3B%0A%7D%0Ah4%2Eauthor%20%7B%0Aborder%2Dbottom%3A%20none%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Apre%20%2Eoperator%2C%0Apre%20%2Eparen%20%7B%0Acolor%3A%20%23888%3B%0A%7D%0Apre%20%2Eliteral%20%7B%0Acolor%3A%20%23990073%3B%0A%7D%0Apre%20%2Enumber%20%7B%0Acolor%3A%20%230080C0%3B%0A%7D%0Apre%20%2Ecomment%20%7B%0Acolor%3A%20%23008000%3B%0Afont%2Dstyle%3A%20italic%0A%7D%0Apre%20%2Ekeyword%20%7B%0Acolor%3A%20%23900%3B%0Afont%2Dweight%3A%20bold%0A%7D%0Apre%20%2Eidentifier%20%7B%0Acolor%3A%20%23000%3B%0A%7D%0Apre%20%2Estring%20%7B%0Acolor%3A%20%23b44%3B%0A%7D%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Introduction to R6 classes</h1>
</div>

<div id="TOC">
<ul>
<li><a href="#r6-classes">R6 classes</a><ul>
<li><a href="#basics">Basics</a></li>
<li><a href="#private-members">Private members</a></li>
<li><a href="#active-bindings">Active bindings</a></li>
<li><a href="#inheritance">Inheritance</a></li>
<li><a href="#fields-containing-reference-objects">Fields containing reference objects</a></li>
</ul></li>
<li><a href="#portable-and-non-portable-classes">Portable and non-portable classes</a><ul>
<li><a href="#using-self-and--">Using <code>self</code> and <code>&lt;&lt;-</code></a></li>
</ul></li>
<li><a href="#other-topics">Other topics</a><ul>
<li><a href="#adding-members-to-an-existing-class">Adding members to an existing class</a></li>
<li><a href="#cloning-objects">Cloning objects</a></li>
<li><a href="#printing-r6-objects-to-the-screen">Printing R6 objects to the screen</a></li>
<li><a href="#finalizers">Finalizers</a></li>
</ul></li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>

<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Introduction to R6 classes}
-->
<p>The R6 package provides a type of class which is similar to R’s standard reference classes, but it is more efficient and doesn’t depend on S4 classes and the methods package.</p>
<div id="r6-classes" class="section level2">
<h2>R6 classes</h2>
<p>R6 classes are similar to R’s standard reference classes, but are lighter weight, and avoid some issues that come along with using S4 classes (R’s reference classes are based on S4). For more information about speed and memory footprint, see the Performance vignette.</p>
<p>Unlike many objects in R, instances (objects) of R6 classes have reference semantics. R6 classes also support:</p>
<ul>
<li>public and private methods</li>
<li>active bindings</li>
<li>inheritance (superclasses) which works across packages</li>
</ul>
<p>Why the name R6? When R’s reference classes were introduced, some users, following the names of R’s existing class systems S3 and S4, called the new class system R5 in jest. Although reference classes are not actually called R5, the name of this package and its classes takes inspiration from that name.</p>
<p>The name R5 was also a code-name used for a different object system started by Simon Urbanek, meant to solve some issues with S4 relating to syntax and performance. However, the R5 branch was shelved after a little development, and it was never released.</p>
<div id="basics" class="section level3">
<h3>Basics</h3>
<p>Here’s how to create a simple R6 class. The <code>public</code> argument is a list of items, which can be functions and fields (non-functions). Functions will be used as methods.</p>
<pre class="r"><code>library(R6)

Person &lt;- R6Class(&quot;Person&quot;,
  public = list(
    name = NA,
    hair = NA,
    initialize = function(name, hair) {
      if (!missing(name)) self$name &lt;- name
      if (!missing(hair)) self$hair &lt;- hair
      self$greet()
    },
    set_hair = function(val) {
      self$hair &lt;- val
    },
    greet = function() {
      cat(paste0(&quot;Hello, my name is &quot;, self$name, &quot;.\n&quot;))
    }
  )
)</code></pre>
<p>To instantiate an object of this class, use <code>$new()</code>:</p>
<pre class="r"><code>ann &lt;- Person$new(&quot;Ann&quot;, &quot;black&quot;)
#&gt; Hello, my name is Ann.
ann
#&gt; &lt;Person&gt;
#&gt;   Public:
#&gt;     clone: function (deep = FALSE) 
#&gt;     greet: function () 
#&gt;     hair: black
#&gt;     initialize: function (name, hair) 
#&gt;     name: Ann
#&gt;     set_hair: function (val)</code></pre>
<p>The <code>$new()</code> method creates the object and calls the <code>initialize()</code> method, if it exists.</p>
<p>Inside methods of the class, <code>self</code> refers to the object. Public members of the object (all you’ve seen so far) are accessed with <code>self$x</code>, and assignment is done with <code>self$x &lt;- y</code>. Note that by default, <code>self</code> is required to access members, although for non-portable classes which we’ll see later, it is optional.</p>
<p>Once the object is instantiated, you can access values and methods with <code>$</code>:</p>
<pre class="r"><code>ann$hair
#&gt; [1] &quot;black&quot;
ann$greet()
#&gt; Hello, my name is Ann.
ann$set_hair(&quot;red&quot;)
ann$hair
#&gt; [1] &quot;red&quot;</code></pre>
<p>Implementation note: The external face of an R6 object is basically an environment with the public members in it. This is also known as the <em>public environment</em>. An R6 object’s methods have a separate <em>enclosing environment</em> which, roughly speaking, is the environment they “run in”. This is where <code>self</code> binding is found, and it is simply a reference back to public environment.</p>
</div>
<div id="private-members" class="section level3">
<h3>Private members</h3>
<p>In the previous example, all the members were public. It’s also possible to add private members:</p>
<pre class="r"><code>Queue &lt;- R6Class(&quot;Queue&quot;,
  public = list(
    initialize = function(...) {
      for (item in list(...)) {
        self$add(item)
      }
    },
    add = function(x) {
      private$queue &lt;- c(private$queue, list(x))
      invisible(self)
    },
    remove = function() {
      if (private$length() == 0) return(NULL)
      # Can use private$queue for explicit access
      head &lt;- private$queue[[1]]
      private$queue &lt;- private$queue[-1]
      head
    }
  ),
  private = list(
    queue = list(),
    length = function() base::length(private$queue)
  )
)

q &lt;- Queue$new(5, 6, &quot;foo&quot;)</code></pre>
<p>Whereas public members are accessed with <code>self</code>, like <code>self$add()</code>, private members are accessed with <code>private</code>, like <code>private$queue</code>.</p>
<p>The public members can be accessed as usual:</p>
<pre class="r"><code># Add and remove items
q$add(&quot;something&quot;)
q$add(&quot;another thing&quot;)
q$add(17)
q$remove()
#&gt; [1] 5
q$remove()
#&gt; [1] 6</code></pre>
<p>However, private members can’t be accessed directly:</p>
<pre class="r"><code>q$queue
#&gt; NULL
q$length()
#&gt; Error: attempt to apply non-function</code></pre>
<p>A useful design pattern is for methods to return <code>self</code> (invisibly) when possible, because it makes them chainable. For example, the <code>add()</code> method returns <code>self</code> so you can chain them together:</p>
<pre class="r"><code>q$add(10)$add(11)$add(12)</code></pre>
<p>On the other hand, <code>remove()</code> returns the value removed, so it’s not chainable:</p>
<pre class="r"><code>q$remove()
#&gt; [1] &quot;foo&quot;
q$remove()
#&gt; [1] &quot;something&quot;
q$remove()
#&gt; [1] &quot;another thing&quot;
q$remove()
#&gt; [1] 17</code></pre>
</div>
<div id="active-bindings" class="section level3">
<h3>Active bindings</h3>
<p>Active bindings look like fields, but each time they are accessed, they call a function. They are always publicly visible.</p>
<pre class="r"><code>Numbers &lt;- R6Class(&quot;Numbers&quot;,
  public = list(
    x = 100
  ),
  active = list(
    x2 = function(value) {
      if (missing(value)) return(self$x * 2)
      else self$x &lt;- value/2
    },
    rand = function() rnorm(1)
  )
)

n &lt;- Numbers$new()
n$x
#&gt; [1] 100</code></pre>
<p>When an active binding is accessed as if reading a value, it calls the function with <code>value</code> as a missing argument:</p>
<pre class="r"><code>n$x2
#&gt; [1] 200</code></pre>
<p>When it’s accessed as if assigning a value, it uses the assignment value as the <code>value</code> argument:</p>
<pre class="r"><code>n$x2 &lt;- 1000
n$x
#&gt; [1] 500</code></pre>
<p>If the function takes no arguments, it’s not possible to use it with <code>&lt;-</code>:</p>
<pre class="r"><code>n$rand
#&gt; [1] 0.2648
n$rand
#&gt; [1] 2.171
n$rand &lt;- 3
#&gt; Error: unused argument (quote(3))</code></pre>
<p>Implementation note: Active bindings are bound in the public environment. The enclosing environment for these functions is also the public environment.</p>
</div>
<div id="inheritance" class="section level3">
<h3>Inheritance</h3>
<p>One R6 class can inherit from another. In other words, you can have super- and sub-classes.</p>
<p>Subclasses can have additional methods, and they can also have methods that override the superclass methods. In this example of a queue that retains its history, we’ll add a <code>show()</code> method and override the <code>remove()</code> method:</p>
<pre class="r"><code># Note that this isn't very efficient - it's just for illustrating inheritance.
HistoryQueue &lt;- R6Class(&quot;HistoryQueue&quot;,
  inherit = Queue,
  public = list(
    show = function() {
      cat(&quot;Next item is at index&quot;, private$head_idx + 1, &quot;\n&quot;)
      for (i in seq_along(private$queue)) {
        cat(i, &quot;: &quot;, private$queue[[i]], &quot;\n&quot;, sep = &quot;&quot;)
      }
    },
    remove = function() {
      if (private$length() - private$head_idx == 0) return(NULL)
      private$head_idx &lt;&lt;- private$head_idx + 1
      private$queue[[private$head_idx]]
    }
  ),
  private = list(
    head_idx = 0
  )
)

hq &lt;- HistoryQueue$new(5, 6, &quot;foo&quot;)
hq$show()
#&gt; Next item is at index 1 
#&gt; 1: 5
#&gt; 2: 6
#&gt; 3: foo
hq$remove()
#&gt; [1] 5
hq$show()
#&gt; Next item is at index 2 
#&gt; 1: 5
#&gt; 2: 6
#&gt; 3: foo
hq$remove()
#&gt; [1] 6</code></pre>
<p>Superclass methods can be called with <code>super$xx()</code>. The <code>CountingQueue</code> (example below) keeps a count of the total number of objects that have ever been added to the queue. It does this by overriding the <code>add()</code> method – it increments a counter and then calls the superclass’s <code>add()</code> method, with <code>super$add(x)</code>:</p>
<pre class="r"><code>CountingQueue &lt;- R6Class(&quot;CountingQueue&quot;,
  inherit = Queue,
  public = list(
    add = function(x) {
      private$total &lt;&lt;- private$total + 1
      super$add(x)
    },
    get_total = function() private$total
  ),
  private = list(
    total = 0
  )
)

cq &lt;- CountingQueue$new(&quot;x&quot;, &quot;y&quot;)
cq$get_total()
#&gt; [1] 2
cq$add(&quot;z&quot;)
cq$remove()
#&gt; [1] &quot;x&quot;
cq$remove()
#&gt; [1] &quot;y&quot;
cq$get_total()
#&gt; [1] 3</code></pre>
</div>
<div id="fields-containing-reference-objects" class="section level3">
<h3>Fields containing reference objects</h3>
<p>If your R6 class contains any fields that also have reference semantics (e.g., other R6 objects, and environments), those fields should be populated in the <code>initialize</code> method. If the field set to the reference object directly in the class definition, that object will be shared across all instances of the R6 objects. Here’s an example:</p>
<pre class="r"><code>SimpleClass &lt;- R6Class(&quot;SimpleClass&quot;,
  public = list(x = NULL)
)

SharedField &lt;- R6Class(&quot;SharedField&quot;,
  public = list(
    e = SimpleClass$new()
  )
)

s1 &lt;- SharedField$new()
s1$e$x &lt;- 1

s2 &lt;- SharedField$new()
s2$e$x &lt;- 2

# Changing s2$e$x has changed the value of s1$e$x
s1$e$x
#&gt; [1] 2</code></pre>
<p>To avoid this, populate the field in the <code>initialize</code> method:</p>
<pre class="r"><code>NonSharedField &lt;- R6Class(&quot;NonSharedField&quot;,
  public = list(
    e = NULL,
    initialize = function() self$e &lt;- SimpleClass$new()
  )
)

n1 &lt;- NonSharedField$new()
n1$e$x &lt;- 1

n2 &lt;- NonSharedField$new()
n2$e$x &lt;- 2

# n2$e$x does not affect n1$e$x
n1$e$x
#&gt; [1] 1</code></pre>
</div>
</div>
<div id="portable-and-non-portable-classes" class="section level2">
<h2>Portable and non-portable classes</h2>
<p>In R6 version 1.0.1, the default was to create <strong>non-portable</strong> classes. In subsequent versions, the default is to create <strong>portable</strong> classes. The two most noticeable differences are that portable classes:</p>
<ul>
<li>Support inheritance across different packages. Non-portable classes do not do this very well.</li>
<li>Always require the use of <code>self</code> and <code>private</code> to access members, as in <code>self$x</code> and <code>private$y</code>. Non-portable classes can access these members with just <code>x</code> and <code>y</code>, and do assignment to these members with the <code>&lt;&lt;-</code> operator.</li>
</ul>
<p>The implementation of the first point is such that it makes the second point necessary.</p>
<div id="using-self-and--" class="section level3">
<h3>Using <code>self</code> and <code>&lt;&lt;-</code></h3>
<p>With reference classes, you can access the field without <code>self</code>, and assign to fields using <code>&lt;&lt;-</code>. For example:</p>
<pre class="r"><code>RC &lt;- setRefClass(&quot;RC&quot;,
  fields = list(x = 'ANY'),
  methods = list(
    getx = function() x,
    setx = function(value) x &lt;&lt;- value
  )
)

rc &lt;- RC$new()
rc$setx(10)
rc$getx()
#&gt; [1] 10</code></pre>
<p>The same is true for non-portable R6 classes:</p>
<pre class="r"><code>NP &lt;- R6Class(&quot;NP&quot;,
  portable = FALSE,
  public = list(
    x = NA,
    getx = function() x,
    setx = function(value) x &lt;&lt;- value
  )
)

np &lt;- NP$new()
np$setx(10)
np$getx()
#&gt; [1] 10</code></pre>
<p>But for portable R6 classes (this is the default), you must use <code>self</code> and/or <code>private</code>, and <code>&lt;&lt;-</code> assignment doesn’t work – unless you use <code>self</code>, of course:</p>
<pre class="r"><code>P &lt;- R6Class(&quot;P&quot;,
  portable = TRUE,  # This is default
  public = list(
    x = NA,
    getx = function() self$x,
    setx = function(value) self$x &lt;- value
  )
)

p &lt;- P$new()
p$setx(10)
p$getx()
#&gt; [1] 10</code></pre>
<p>For more information, see the Portable vignette.</p>
</div>
</div>
<div id="other-topics" class="section level2">
<h2>Other topics</h2>
<div id="adding-members-to-an-existing-class" class="section level3">
<h3>Adding members to an existing class</h3>
<p>It is sometimes useful to add members to a class after the class has already been created. This can be done using the <code>$set()</code> method on the generator object.</p>
<pre class="r"><code>Simple &lt;- R6Class(&quot;Simple&quot;,
  public = list(
    x = 1,
    getx = function() self$x
  )
)

Simple$set(&quot;public&quot;, &quot;getx2&quot;, function() self$x*2)

# To replace an existing member, use overwrite=TRUE
Simple$set(&quot;public&quot;, &quot;x&quot;, 10, overwrite = TRUE)

s &lt;- Simple$new()
s$x
#&gt; [1] 10
s$getx2()
#&gt; [1] 20</code></pre>
<p>The new members will be present only in instances that are created after <code>$set()</code> has been called.</p>
<p>To prevent modification of a class, you can use <code>lock_class=TRUE</code> when creating the class. You can also lock and unlock a class as follows:</p>
<pre class="r"><code># Create a locked class
Simple &lt;- R6Class(&quot;Simple&quot;,
  public = list(
    x = 1,
    getx = function() self$x
  ),
  lock_class = TRUE
)

# This would result in an error
# Simple$set(&quot;public&quot;, &quot;y&quot;, 2)

# Unlock the class
Simple$unlock()

# Now it works
Simple$set(&quot;public&quot;, &quot;y&quot;, 2)

# Lock the class again
Simple$lock()</code></pre>
</div>
<div id="cloning-objects" class="section level3">
<h3>Cloning objects</h3>
<p>By default, R6 objects have method named <code>clone</code> for making a copy of the object.</p>
<pre class="r"><code>Simple &lt;- R6Class(&quot;Simple&quot;,
  public = list(
    x = 1,
    getx = function() self$x
  )
)

s &lt;- Simple$new()

# Create a clone
s1 &lt;- s$clone()
# Modify it
s1$x &lt;- 2
s1$getx()
#&gt; [1] 2

# Original is unaffected by changes to the clone
s$getx()
#&gt; [1] 1</code></pre>
<p>If you don’t want a <code>clone</code> method to be added, you can use <code>cloneable=FALSE</code> when creating the class. If any loaded R6 object has a <code>clone</code> method, that function uses 43.2 kB, but for each additional object, the <code>clone</code> method costs a trivial amount of space (112 bytes).</p>
<div id="deep-cloning" class="section level4">
<h4>Deep cloning</h4>
<p>If there are any fields which are objects with reference sematics (environments, R6 objects, reference class objects), the copy will get a reference to the same object. This is sometimes desirable, but often it is not.</p>
<p>For example, we’ll create an object <code>c1</code> which contains another R6 object, <code>s</code>, and then clone it. Because the original’s and the clone’s <code>s</code> fields both refer to the same object, modifying it from one results in a change that is reflect in the other.</p>
<pre class="r"><code>Simple &lt;- R6Class(&quot;Simple&quot;, public = list(x = 1))

Cloneable &lt;- R6Class(&quot;Cloneable&quot;,
  public = list(
    s = NULL,
    initialize = function() self$s &lt;- Simple$new()
  )
)

c1 &lt;- Cloneable$new()
c2 &lt;- c1$clone()

# Change c1's `s` field
c1$s$x &lt;- 2

# c2's `s` is the same object, so it reflects the change
c2$s$x
#&gt; [1] 2</code></pre>
<p>To make it so the clone receives a <em>copy</em> of <code>s</code>, we can use the <code>deep=TRUE</code> option:</p>
<pre class="r"><code>c3 &lt;- c1$clone(deep = TRUE)

# Change c1's `s` field
c1$s$x &lt;- 3

# c2's `s` is different
c3$s$x
#&gt; [1] 2</code></pre>
<p>The default behavior of <code>clone(deep=TRUE)</code> is to copy fields which are R6 objects, but not copy fields which are environments, reference class objects, or other data structures which contain other reference-type objects (for example, a list with an R6 object).</p>
<p>If your R6 object contains these types of objects and you want to make a deep clone of them, you must provide your own function for deep cloning, in a private method named <code>deep_clone</code>. Below is an example of an R6 object with two fields, <code>a</code> and <code>b</code>, both of which which are environments, and both of which contain a value <code>x</code>. It also has a field <code>v</code> which is a regular (non-reference) value, and a private <code>deep_clone</code> method.</p>
<p>The <code>deep_clone</code> method is be called once for each field. It is passed the name and value of the field, and the value it returns is be used in the clone.</p>
<pre class="r"><code>CloneEnv &lt;- R6Class(&quot;CloneEnv&quot;,
  public = list(
    a = NULL,
    b = NULL,
    v = 1,
    initialize = function() {
      self$a &lt;- new.env(parent = emptyenv())
      self$b &lt;- new.env(parent = emptyenv())
      self$a$x &lt;- 1
      self$b$x &lt;- 1
    }
  ),
  private = list(
    deep_clone = function(name, value) {
      # With x$clone(deep=TRUE) is called, the deep_clone gets invoked once for
      # each field, with the name and value.
      if (name == &quot;a&quot;) {
        # `a` is an environment, so use this quick way of copying
        list2env(as.list.environment(value, all.names = TRUE),
                 parent = emptyenv())
      } else {
        # For all other fields, just return the value
        value
      }
    }
  )
)

c1 &lt;- CloneEnv$new()
c2 &lt;- c1$clone(deep = TRUE)</code></pre>
<p>When <code>c1$clone(deep=TRUE)</code> is called, the <code>deep_clone</code> method is called for each field in <code>c1</code>, and is passed the name of the field and value. In our version, the <code>a</code> environment gets copied, but <code>b</code> does not, nor does <code>v</code> (but that doesn’t matter since <code>v</code> is not a reference object). We can test out the clone:</p>
<pre class="r"><code># Modifying c1$a doesn't affect c2$a, because they're separate objects
c1$a$x &lt;- 2
c2$a$x
#&gt; [1] 1

# Modifying c1$b does affect c2$b, because they're the same object
c1$b$x &lt;- 3
c2$b$x
#&gt; [1] 3

# Modifying c1$v doesn't affect c2$v, because they're not reference objects
c1$v &lt;- 4
c2$v
#&gt; [1] 1</code></pre>
<p>In the example <code>deep_clone</code> method above, we checked the name of each field to determine what to do with it, but we could also check the value, by using <code>inherits(value, &quot;R6&quot;)</code>, or <code>is.environment()</code>, and so on.</p>
</div>
</div>
<div id="printing-r6-objects-to-the-screen" class="section level3">
<h3>Printing R6 objects to the screen</h3>
<p>R6 objects have a default <code>print</code> method that lists all members of the object. If a class defines a <code>print</code> method, then it overrides the default one.</p>
<pre class="r"><code>PrettyCountingQueue &lt;- R6Class(&quot;PrettyCountingQueue&quot;,
  inherit = CountingQueue,
  public = list(
    print = function(...) {
      cat(&quot;&lt;PrettyCountingQueue&gt; of &quot;, self$get_total(), &quot; elements\n&quot;, sep = &quot;&quot;)
      invisible(self)
    }
  )
)</code></pre>
<pre class="r"><code>pq &lt;- PrettyCountingQueue$new(1, 2, &quot;foobar&quot;)
pq
#&gt; &lt;PrettyCountingQueue&gt; of 3 elements</code></pre>
</div>
<div id="finalizers" class="section level3">
<h3>Finalizers</h3>
<p>Sometimes it’s useful to run a function when the object is garbage collected. For example, you may want to make sure a file or database connection gets closed. To do this, you can call the <code>reg.finalizer()</code> function in your <code>initialize</code> method, and pass it <code>self</code> as the object that will trigger the function when it is garbage collected.</p>
<pre class="r"><code>A &lt;- R6Class(&quot;A&quot;, public = list(
  initialize = function() {
    reg.finalizer(self,
                  function(e) print(&quot;Finalizer has been called!&quot;),
                  onexit = TRUE)
  }
))


# Instantiate an object, but don't save a reference to it
A$new()
#&gt; &lt;A&gt;
#&gt;   Public:
#&gt;     clone: function (deep = FALSE) 
#&gt;     initialize: function ()

# Run something else to get rid of any references to the object, because the
# last returned value is saved in .Last.value
1+1
#&gt; [1] 2

# Force immediate garbage collection (normally this will happen automatically
# from time to time)
gc()
#&gt; [1] &quot;Finalizer has been called!&quot;
#&gt;          used (Mb) gc trigger (Mb) max used (Mb)
#&gt; Ncells 405943 21.7     750400 40.1   592000 31.7
#&gt; Vcells 638001  4.9    1308461 10.0   956412  7.3</code></pre>
<p>In the example above, we used <code>onexit=TRUE</code>, so that the finalizer will alsobe called when R exits. This is useful in some cases, like database connections, but it isn’t necessary for others, like open files, since they will be closed anyway when the R process exits.</p>
</div>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>R6 classes provide capabilities that are common in other object-oriented programming languages. They’re similar to R’s built-in reference classes, but are simpler, smaller, and faster, and they allow inheritance across packages.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
